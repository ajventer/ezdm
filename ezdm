#!/usr/bin/env python
from bottle import route, run, request

sessions = {}


@route('/', method='get')
@route('/<action>', method='get')
def main_page(action=None):
    global sessions
    action = action or 'HOME'
    try:
        exec 'from ezdm_libs.ezdm_%s import %s as ActionSession' % (action.lower(), action.upper())
    except:
        from ezdm_libs.frontend import Session as ActionSession
    if not action in sessions:
        sessions[action] = ActionSession()
    print sessions
    return sessions[action].render(request)


if __name__ == '__main__':
    run(host='0.0.0.0', port=8000, reload=True)
